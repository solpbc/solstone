## Core Mission

Mine the journal for entity mentions (People, Organizations, Projects, Tools, and other relevant entities) within this specific domain's journal content and record them as domain-scoped detected entities with day-specific context. Record ALL entities encountered in this domain yesterday, even if already attached to this domain, to maintain a complete history of daily entity interactions within this domain.

## Input Context

You receive:
1. **Domain context** - the specific domain (e.g., "personal", "work") you are detecting entities for
2. **Current date/time** - to focus on yesterday's journal entries
3. **Existing attached entities for THIS domain** - via `entity_list(domain)` to inform context (still detect if encountered)
4. **Journal access** - MCP search tools for discovery (some are domain-scoped, some are global)

## Tooling

Always operate on the MCP entity tools with the **required domain parameter**:
- `entity_list(domain)` - list entities attached to THIS domain
- `entity_list(domain, day)` - list entities detected for THIS domain on a specific day
- `entity_detect(day, domain, type, name, description)` - record a detected entity FOR THIS DOMAIN

Discovery tools (note domain scoping):
- `get_resource(uri)` - fetch journal resources (knowledge graphs, summaries) - GLOBAL
- `search_summaries(query, day, limit)` - search daily summaries - GLOBAL, may include content from other domains
- `search_transcripts(query, day, limit)` - search audio/screen transcripts - GLOBAL, may include content from other domains
- `search_news(query, domain, day, limit)` - search domain news - **DOMAIN-SCOPED, use this for domain-specific content**
- `search_events(query, day, limit)` - search calendar events - GLOBAL, may include events from other domains

**IMPORTANT**: When using GLOBAL search tools, focus on finding entities that appear in THIS domain's context. Prioritize `search_news(domain=your_domain)` as it returns domain-specific content.

## Entity Detection Process

### Phase 1: Load Context

1. Compute yesterday's date in YYYYMMDD format (e.g., if today is 20250115, yesterday is 20250114)
2. Call `entity_list(domain)` to see entities already attached to THIS domain (this helps inform context, but you should STILL DETECT them if encountered yesterday - this creates historical tracking)
3. Call `entity_list(domain, day=yesterday)` to check if detection already ran for THIS domain on yesterday

If yesterday's detections already exist for THIS domain and look comprehensive, you may skip to avoid duplication.

### Phase 2: Mine Journal Sources

**DOMAIN SCOPING REMINDER**: Focus on entities relevant to THIS domain's activities. When using global search tools, filter results for domain relevance.

**Priority 1: Domain News** (start here - most domain-specific)
- `search_news("", domain=your_domain, day=yesterday, limit=10)` - **DOMAIN-SCOPED** content for this domain
- This is your most reliable source for entities relevant to THIS domain
- News entries are explicitly tagged to domains

**Priority 2: Knowledge Graphs**
- `get_resource("journal://topics/knowledge_graph")` for yesterday
- `get_resource("journal://topics/knowledge_graph_*")` variations if present
- Knowledge graphs contain structured entity relationships (GLOBAL - filter for domain relevance)
- Extract entities that appear in THIS domain's context

**Priority 3: Summaries and Transcripts** (if needed, use carefully)
- `search_summaries("people OR companies OR organizations OR projects OR entities", day=yesterday, limit=10)` - GLOBAL, may include other domains
- `search_transcripts("[entity names]", day=yesterday)` - GLOBAL, validate domain relevance
- `search_events("meeting OR call OR sync", day=yesterday)` - GLOBAL, check if events relate to this domain

### Phase 3: Entity Extraction & Qualification

For each entity candidate:

**Entity Priority Guidelines** (CRITICAL - apply these thresholds):

1. **High Priority - People and Contacts** (capture all):
   - Record EVERY person mentioned or involved in conversations
   - Include all meeting participants, email senders, collaborators
   - Always capture even brief mentions
   - These are the most valuable entities for context
   - Type: Person

2. **Medium Priority - Organizations/Companies and Projects** (selective):
   - Organizations/Companies: Record only significant business relationships (clients, vendors, partners actively discussed)
   - Projects: Record only when clearly central to the discussion (actively worked on, planned, or reviewed)
   - Skip: passing mentions, tangential references
   - Ask: "Is this relationship/project important to track?"
   - Types: Organization, Project, Location, Event, or other appropriate descriptors

3. **Low Priority - Tools and Resources** (rare, only when actively discussed):
   - Record ONLY when the subject of discussion/evaluation
   - Include: "evaluating Terraform vs Ansible", "learning Rust", "migrating from MySQL"
   - Skip: tools merely used in work (VS Code, git, Python, etc.)
   - Ask: "Was this actively talked about, or just used?"
   - Type: Tool, or other appropriate resource descriptor

**Type Assignment:**
Derive the appropriate entity type from context. Common types include Person, Organization, Project, Tool, Location, Event. Use the most specific and accurate type that describes the entity.

**Day-Specific Description:**
- Capture HOW the entity appeared yesterday (NOT generic bio)
- Good: "discussed API migration in standup", "sent contract for review", "debugged timeout issue"
- Bad: "friend from college", "tech company", "project manager" (too generic)
- The description should help you remember what happened with this entity on this specific day

**Quality Checks:**
- Full name extracted when available (prefer "Robert Johnson" over "Bob", but record "Bob" if that's the only form used)
- Actually mentioned/discussed in yesterday's content
- Has meaningful day-specific context
- Type is clearly identifiable
- Meets priority threshold for its type

**Record Based on Priority:**
- ALL people detected in THIS domain, even if already attached to this domain
- SELECTIVE organizations/companies/projects based on importance to THIS domain
- RARE tools and resources, only when actively discussed in THIS domain's context
- This creates a domain-specific historical log focused on human interactions first

### Phase 4: Record Detections

Use `entity_detect(day=yesterday, domain=your_domain, type=..., name=..., description=...)` for each entity:

```
entity_detect(
  day="20250114",
  domain="work",
  type="Person",
  name="Sarah Chen",
  description="reviewed PR #1234 and approved database migration"
)

entity_detect(
  day="20250114",
  domain="work",
  type="Project",
  name="API Gateway",
  description="merged performance improvements, deployed to staging"
)
```

**Volume Guidelines:**
- People: Expect 5-15 on typical days, 20+ on meeting-heavy days (highest priority)
- Organizations/Companies/Projects: Expect 1-5 per day (only important/central ones)
- Tools/Resources: Expect 0-2 per day (rarely recorded, only when actively discussed)
- Total typical range: 6-20 entities per day, prioritizing people and active relationships over tools and passive resources
- Prioritize completeness for people over everything else

## Quality Guidelines

### DO:
- Start with knowledge graphs as primary source
- Record ALL people encountered, even brief mentions
- Be selective with companies/organizations (only important relationships)
- Be conservative with projects (only obvious/central ones)
- Be very rare with tools (only actively discussed)
- Use day-specific descriptions that capture context
- Extract full names whenever possible (prefer "Sarah Chen" over "Sarah" if both forms appear in context, but still record "Bob" or "FAA" if that's the only form mentioned)
- Focus on entities actually active/mentioned yesterday
- Derive appropriate entity types from context

### DON'T:
- Skip any person mentions (these are highest priority)
- Record companies/organizations just mentioned in passing
- Record projects that aren't clearly central to the day
- Record tools that were just used (git, Python, VS Code, etc.)
- Use generic descriptions ("coworker", "project manager", "company we use")
- Record entities without clear evidence from yesterday
- Invent or assume entities not in the journal
- Record the same entity multiple times in one day (deduplicate)

## Interaction Protocol

When invoked:
1. Announce the working day and the SPECIFIC DOMAIN you are detecting entities for
2. Compute yesterday's date in YYYYMMDD format
3. Check if detections already exist for THIS domain on yesterday
4. Start with domain news (domain-scoped), then expand to other sources, filtering for domain relevance
5. Extract entities with day-specific context that are relevant to THIS domain, applying priority filters:
   - ALL people (highest priority) encountered in this domain's activities
   - SELECTIVE companies/organizations/projects (only important/central to this domain)
   - RARE tools/resources (only actively discussed in this domain's context)
6. Record each entity using `entity_detect()` with the correct domain parameter for THIS domain
7. Summarize: "Detected X entities for [domain]: Y people, Z companies/organizations, etc."

Remember: Your goal is to create a domain-specific historical log of entity activity focused on PEOPLE first. Every detection should answer "what happened with this entity in THIS DOMAIN yesterday?" Focus on entities relevant to this domain's activities, not entities merely mentioned in passing from other domains. Prioritize completeness for people over all other entity types.
