{% extends 'base.html' %}
{% set title = matter_data.metadata.title or 'Matter' %}
{% set active = 'domains' %}
{% block head %}
<style>
/* Matter header */
.matter-header {
  position: relative;
  width: 100%;
  padding: 3em 2em;
  margin-bottom: 2em;
  color: white;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  border-radius: 0 0 16px 16px;
  overflow: hidden;
}

.matter-header.has-color {
  background: var(--matter-color);
}

.matter-header h1 {
  margin: 0 0 0.5em 0;
  font-size: 2.5em;
  font-weight: 700;
  color: white;
  background: none;
  -webkit-background-clip: unset;
  -webkit-text-fill-color: unset;
  background-clip: unset;
}

.matter-header .description {
  font-size: 1.2em;
  opacity: 0.9;
  line-height: 1.4;
  margin: 0;
  max-width: 800px;
}

.matter-meta-row {
  margin-top: 1em;
  display: flex;
  align-items: center;
  gap: 2em;
  flex-wrap: wrap;
}

.matter-info-item {
  display: flex;
  align-items: center;
  gap: 0.5em;
  font-size: 1.1em;
  opacity: 0.9;
}

.matter-info-item .icon {
  font-size: 1.2em;
}

.matter-status {
  background: rgba(255, 255, 255, 0.2);
  padding: 0.3em 0.8em;
  border-radius: 16px;
  font-size: 0.9em;
  font-weight: 500;
  text-transform: capitalize;
}

.matter-priority {
  background: rgba(255, 255, 255, 0.2);
  padding: 0.3em 0.8em;
  border-radius: 16px;
  font-size: 0.9em;
  font-weight: 500;
  text-transform: capitalize;
}

.matter-tags {
  display: flex;
  gap: 0.5em;
  flex-wrap: wrap;
}

.matter-tag {
  background: rgba(255, 255, 255, 0.2);
  padding: 0.3em 0.8em;
  border-radius: 16px;
  font-size: 0.8em;
  font-weight: 500;
}

/* Back button */
.back-button {
  position: absolute;
  top: 1em;
  left: 1em;
  color: white;
  text-decoration: none;
  font-size: 1.1em;
  opacity: 0.8;
  transition: opacity 0.2s;
}

.back-button:hover {
  opacity: 1;
  color: white;
}

/* Tab navigation */
.tab-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 2em;
}

.tab-nav {
  display: flex;
  border-bottom: 2px solid #eee;
  margin-bottom: 2em;
}

.tab-button {
  background: none;
  border: none;
  padding: 1em 2em;
  font-size: 1.1em;
  font-weight: 500;
  color: #666;
  cursor: pointer;
  border-bottom: 3px solid transparent;
  transition: all 0.2s;
}

.tab-button:hover {
  color: #333;
  background: #f8f9fa;
}

.tab-button.active {
  color: #28a745;
  border-bottom-color: #28a745;
  background: #f0fff4;
}

/* Tab content */
.tab-content {
  display: none;
  padding: 2em 0;
}

.tab-content.active {
  display: block;
}

.tab-content h2 {
  color: #333;
  margin-bottom: 1.5em;
  font-size: 1.8em;
}

/* Content styling */
.content-section {
  background: white;
  border-radius: 12px;
  border: 1px solid #e9ecef;
  overflow: hidden;
}

.content-section h3 {
  background: #f8f9fa;
  margin: 0;
  padding: 1rem 1.5rem;
  font-size: 1.2em;
  font-weight: 600;
  color: #495057;
  border-bottom: 1px solid #e9ecef;
}

.content-list {
  padding: 0;
  margin: 0;
  list-style: none;
}

.content-item {
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #f1f3f4;
  transition: background-color 0.2s;
}

.content-item:last-child {
  border-bottom: none;
}

.content-item:hover {
  background-color: #f8f9fa;
}

.item-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.item-title {
  font-weight: 600;
  color: #343a40;
  margin: 0;
}

.item-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 0.9em;
  color: #6c757d;
}

.status-badge {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.8em;
  font-weight: 500;
  text-transform: capitalize;
}

.status-pending {
  background-color: #fff3cd;
  color: #856404;
}

.status-in-progress, .status-in_progress {
  background-color: #cff4fc;
  color: #055160;
}

.status-completed {
  background-color: #d1edff;
  color: #084298;
}

.status-active {
  background-color: #d4edda;
  color: #155724;
}

.priority-high {
  color: #dc3545;
}

.priority-medium {
  color: #fd7e14;
}

.priority-low {
  color: #28a745;
}

.item-description {
  color: #6c757d;
  margin: 0.5rem 0;
  line-height: 1.4;
}

.log-entry {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
}

.log-timestamp {
  font-size: 0.85em;
  color: #6c757d;
  white-space: nowrap;
  min-width: 120px;
}

.log-content {
  flex: 1;
}

.log-type {
  display: inline-block;
  padding: 0.15rem 0.5rem;
  border-radius: 8px;
  font-size: 0.75em;
  font-weight: 500;
  text-transform: uppercase;
  margin-right: 0.5rem;
}

.log-type-created {
  background-color: #e7f3ff;
  color: #0969da;
}

.log-type-update {
  background-color: #fff8e1;
  color: #bf8700;
}

.log-type-progress {
  background-color: #f0f9ff;
  color: #0284c7;
}

.log-type-completed {
  background-color: #f0fdf4;
  color: #16a34a;
}

.attachment-item {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.attachment-icon {
  font-size: 1.5em;
  width: 2em;
  text-align: center;
}

.attachment-info {
  flex: 1;
}

.attachment-name {
  font-weight: 600;
  color: #343a40;
  margin: 0;
}

.attachment-meta {
  font-size: 0.9em;
  color: #6c757d;
  margin-top: 0.25rem;
}

.empty-state {
  text-align: center;
  padding: 3rem;
  color: #6c757d;
}

.empty-state .icon {
  font-size: 2.5em;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-state h4 {
  color: #adb5bd;
  margin-bottom: 0.5rem;
}

.empty-state p {
  margin: 0;
  line-height: 1.4;
}
</style>
{% endblock %}
{% block body %}
<div class="matter-header{% if domain_data.color %} has-color{% endif %}"{% if domain_data.color %} style="--matter-color: {{ domain_data.color }}"{% endif %}>
  <a href="{{ url_for('domains.domain_detail', domain_name=domain_name) }}" class="back-button">‚Üê Back to {{ domain_data.title or domain_name }}</a>
  
  <h1>{{ matter_data.metadata.title or 'Untitled Matter' }}</h1>
  
  {% if matter_data.metadata.description %}
  <p class="description">{{ matter_data.metadata.description }}</p>
  {% endif %}
  
  <div class="matter-meta-row">
    {% if matter_data.metadata.status %}
    <div class="matter-info-item">
      <span class="icon">üìä</span>
      <span class="matter-status">{{ matter_data.metadata.status }}</span>
    </div>
    {% endif %}
    
    {% if matter_data.metadata.priority %}
    <div class="matter-info-item">
      <span class="icon">‚ö°</span>
      <span class="matter-priority">{{ matter_data.metadata.priority }}</span>
    </div>
    {% endif %}
    
    {% if matter_data.metadata.created %}
    <div class="matter-info-item">
      <span class="icon">üìÖ</span>
      <span>Created {{ matter_data.metadata.created }}</span>
    </div>
    {% endif %}
    
    {% if matter_data.metadata.tags %}
    <div class="matter-info-item">
      <span class="icon">üè∑Ô∏è</span>
      <div class="matter-tags">
        {% for tag in matter_data.metadata.tags %}
        <span class="matter-tag">{{ tag }}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

<div class="tab-container">
  <div class="tab-nav">
    <button class="tab-button active" data-tab="objectives">Objectives</button>
    <button class="tab-button" data-tab="logs">Logs</button>
    <button class="tab-button" data-tab="attachments">Attachments</button>
  </div>
  
  <div id="objectives-tab" class="tab-content active">
    {% if matter_data.objectives %}
    <div class="content-section">
      <h3>üéØ Objectives ({{ matter_data.objectives|length }})</h3>
      <ul class="content-list">
        {% for obj_id, objective in matter_data.objectives.items() %}
        <li class="content-item">
          <div class="item-header">
            <h4 class="item-title">{{ objective.metadata.title or 'Untitled Objective' }}</h4>
            <div class="item-meta">
              {% if objective.metadata.status %}
              <span class="status-badge status-{{ objective.metadata.status }}">{{ objective.metadata.status }}</span>
              {% endif %}
              {% if objective.metadata.priority %}
              <span class="priority-{{ objective.metadata.priority }}">‚ö° {{ objective.metadata.priority }}</span>
              {% endif %}
            </div>
          </div>
          {% if objective.metadata.description %}
          <p class="item-description">{{ objective.metadata.description }}</p>
          {% endif %}
          {% if objective.activity_log %}
          <div class="item-meta">
            <small>üìÖ {{ objective.activity_log|length }} activity log entries</small>
            {% if objective.metadata.target_date %}
            <small>üéØ Target: {{ objective.metadata.target_date }}</small>
            {% endif %}
          </div>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
    {% else %}
    <div class="empty-state">
      <div class="icon">üéØ</div>
      <h4>No Objectives</h4>
      <p>This matter doesn't have any objectives yet.</p>
    </div>
    {% endif %}
  </div>
  
  <div id="logs-tab" class="tab-content">
    {% if matter_data.activity_log %}
    <div class="content-section">
      <h3>üìù Activity Log ({{ matter_data.activity_log|length }} entries)</h3>
      <ul class="content-list">
        {% for log_entry in matter_data.activity_log %}
        <li class="content-item">
          <div class="log-entry">
            <div class="log-timestamp">
              {% if log_entry.timestamp %}
              {{ log_entry.timestamp[:10] }}<br>
              <small>{{ log_entry.timestamp[11:19] }}</small>
              {% endif %}
            </div>
            <div class="log-content">
              {% if log_entry.type %}
              <span class="log-type log-type-{{ log_entry.type }}">{{ log_entry.type }}</span>
              {% endif %}
              {{ log_entry.description or log_entry.message or 'No description' }}
              {% if log_entry.user %}
              <small style="color: #adb5bd; margin-left: 0.5rem;">‚Äî {{ log_entry.user }}</small>
              {% endif %}
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% else %}
    <div class="empty-state">
      <div class="icon">üìù</div>
      <h4>No Activity Logs</h4>
      <p>This matter doesn't have any activity log entries yet.</p>
    </div>
    {% endif %}
  </div>
  
  <div id="attachments-tab" class="tab-content">
    {% if matter_data.attachments %}
    <div class="content-section">
      <h3>üìé Attachments ({{ matter_data.attachments|length }})</h3>
      <ul class="content-list">
        {% for att_name, attachment in matter_data.attachments.items() %}
        <li class="content-item">
          <div class="attachment-item">
            <div class="attachment-icon">
              {% if attachment.mime_type %}
                {% if attachment.mime_type.startswith('image/') %}üñºÔ∏è
                {% elif attachment.mime_type.startswith('text/') %}üìù
                {% elif attachment.mime_type == 'application/pdf' %}üìÑ
                {% elif attachment.mime_type.startswith('video/') %}üé•
                {% elif attachment.mime_type.startswith('audio/') %}üéß
                {% else %}üìé
                {% endif %}
              {% else %}üìé
              {% endif %}
            </div>
            <div class="attachment-info">
              <h4 class="attachment-name">{{ attachment.title or att_name }}</h4>
              {% if attachment.description %}
              <p class="item-description">{{ attachment.description }}</p>
              {% endif %}
              <div class="attachment-meta">
                {% if attachment.mime_type %}
                <span>{{ attachment.mime_type }}</span>
                {% endif %}
                {% if attachment.size %}
                <span>‚Ä¢ {{ (attachment.size / 1024) | round(1) }} KB</span>
                {% endif %}
              </div>
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% else %}
    <div class="empty-state">
      <div class="icon">üìé</div>
      <h4>No Attachments</h4>
      <p>This matter doesn't have any attachments yet.</p>
    </div>
    {% endif %}
  </div>
</div>

<script>
const domainName = '{{ domain_name }}';
const matterTimestamp = '{{ matter_timestamp }}';
const matterData = {{ matter_data | tojson }};

// Tab switching functionality
document.addEventListener('DOMContentLoaded', function() {
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const targetTab = this.dataset.tab;
      
      // Remove active class from all buttons and content
      tabButtons.forEach(btn => btn.classList.remove('active'));
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Add active class to clicked button and corresponding content
      this.classList.add('active');
      document.getElementById(targetTab + '-tab').classList.add('active');
      
      console.log('Switched to tab:', targetTab);
    });
  });
  
  // Debug: Log matter data to console
  console.log('Matter data:', matterData);
});
</script>
{% endblock %}