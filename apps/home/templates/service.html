{# Home app background service - example implementation #}
window.AppServices.register('home', {

  initialize() {
    console.log('[Home Service] Initialized');

    // Check if WebSocket events are available
    if (!window.appEvents) {
      console.warn('[Home Service] WebSocket events not available');
      return;
    }

    // Listen to all events for demonstration
    window.appEvents.listen('*', this.handleEvent.bind(this));
  },

  handleEvent(msg) {
    // Log all events for debugging
    console.log('[Home Service] Event:', msg.tract, msg);

    // Example: Show notification card for specific events
    if (msg.tract === 'cortex' && msg.event === 'agent_complete') {
      this.notifyAgentComplete(msg);
    }

    if (msg.tract === 'indexer' && msg.event === 'day_indexed') {
      this.notifyDayIndexed(msg);
    }

    if (msg.tract === 'task' && msg.event === 'task_complete') {
      this.notifyTaskComplete(msg);
    }
  },

  notifyAgentComplete(msg) {
    // Only notify if not currently viewing the home app
    if (this.isCurrentApp()) {
      return; // User is already in the app, no need to notify
    }

    const agentName = msg.agent || 'Agent';
    window.AppServices.notifications.show({
      app: 'home',
      icon: 'ðŸ¤–',
      title: 'Agent Complete',
      message: `${agentName} finished processing`,
      action: '/app/home',
      autoDismiss: 10000  // Auto-dismiss after 10 seconds
    });
  },

  notifyDayIndexed(msg) {
    if (this.isCurrentApp()) {
      return;
    }

    const day = msg.day || 'today';
    window.AppServices.notifications.show({
      app: 'home',
      icon: 'ðŸ“‡',
      title: 'Indexing Complete',
      message: `${day} has been indexed`,
      action: '/app/home',
      autoDismiss: 8000
    });
  },

  notifyTaskComplete(msg) {
    if (this.isCurrentApp()) {
      return;
    }

    const taskName = msg.task || 'Task';
    window.AppServices.notifications.show({
      app: 'home',
      icon: 'âœ…',
      title: 'Task Complete',
      message: `${taskName} finished`,
      action: '/app/home',
      autoDismiss: 10000
    });
  },

  isCurrentApp() {
    // Check if home app is currently active
    const menuItem = document.querySelector('.menu-item[data-app="home"]');
    return menuItem && menuItem.classList.contains('current');
  }

});
