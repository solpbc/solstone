{% extends 'base.html' %}
{% set title = 'Manage Entities - ' + domain_name %}
{% set active = 'domains' %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='entity_manager.css') }}">
{% endblock %}
{% block body %}
<div class="entity-manager-container">
  <div class="entity-manager-header">
    <a href="{{ url_for('domains.domain_detail', domain_name=domain_name) }}" class="back-button">‚Üê Back to {{ domain_name }}</a>
    <h1>Manage Entities</h1>
    <p class="subtitle">Drag detected entities onto attached entities to add as alternative names</p>
  </div>

  <div class="entity-manager-content">
    <!-- Attached Entities Section -->
    <section class="attached-entities-section">
      <h2>Attached Entities</h2>
      <div class="entity-grid attached-grid" id="attached-grid">
        {% if attached_entities %}
          {% for entity in attached_entities %}
          <div class="entity-card attached"
               data-entity-name="{{ entity.name }}"
               data-entity-type="{{ entity.type }}"
               data-aka="{{ entity.aka|join(',') if entity.aka else '' }}">
            <div class="entity-name">{{ entity.name }}</div>
            {% if entity.aka %}
            <div class="entity-aka-count">({{ entity.aka|length }} aka)</div>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <p>No attached entities yet.</p>
            <p class="empty-hint">Attach entities from the Entities tab on the domain page.</p>
          </div>
        {% endif %}
      </div>
    </section>

    <!-- Detected Entities Section -->
    <section class="detected-entities-section">
      <h2>Detected Entities (Last 30 Days)</h2>
      <div class="entity-grid detected-grid" id="detected-grid">
        {% if detected_entities %}
          {% for entity in detected_entities %}
          <div class="entity-card detected"
               data-entity-name="{{ entity.name }}"
               data-entity-type="{{ entity.type }}">
            <div class="entity-name">{{ entity.name }}</div>
          </div>
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <p>No detected entities in the last 30 days.</p>
          </div>
        {% endif %}
      </div>
    </section>
  </div>
</div>

<!-- Merge Confirmation Modal -->
<div id="merge-modal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Alternative Name</h3>
    </div>
    <div class="modal-body">
      <p>Add "<strong id="source-name"></strong>" to "<strong id="target-name"></strong>" as an alternative name?</p>
      <p class="modal-hint">This will help with audio transcription recognition.</p>
    </div>
    <div class="modal-actions">
      <button id="cancel-merge" class="btn btn-secondary">Cancel</button>
      <button id="confirm-merge" class="btn btn-primary">Confirm</button>
    </div>
  </div>
</div>

<!-- AKA Edit Modal -->
<div id="aka-edit-modal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Alternative Names</h3>
    </div>
    <div class="modal-body">
      <p>Entity: <strong id="edit-entity-name"></strong></p>
      <input type="text" id="aka-input" placeholder="alias1, alias2, alias3" autocomplete="off">
      <p class="modal-hint">Press <kbd>Enter</kbd> to save, <kbd>Esc</kbd> to cancel</p>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='entity_manager.js') }}"></script>
<script>
// Pass server-side data to JavaScript
const domainName = '{{ domain_name }}';
</script>
{% endblock %}
